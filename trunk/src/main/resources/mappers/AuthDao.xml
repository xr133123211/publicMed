<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.pubmed.medicine.dao.AuthDao">

    <select id="getByUserId" resultType="Auth">
       SELECT a.* ,b.name as userName,c.name as orgName,d.name as categoryName
        FROM trust a
        left join users b on a.user_id=b.id
        left join users c on a.org_id=c.id
        left join type_value d on a.type = d.id
        where a.user_id = #{user_id}
    </select>
    <select id="getByOrgId" resultType="Auth">
        SELECT a.* ,b.name as userName,c.name as orgName,d.name as categoryName
        FROM trust a
        left join users b on a.user_id=b.id
        left join users c on a.org_id=c.id
        left join type_value d on a.type = d.id
        where a.org_id = #{org_id}
    </select>

    <select id="getOrgs" resultType="User">
        SELECT org.* from trust t
        inner join users org on t.org_id = org.id
        where t.user_id=#{user_id} and t.type = #{type}
    </select>

    
    <insert id="insert" parameterType="Auth">
        INSERT into trust
        (user_id,org_id,type,weight,trustDate,status)
        VALUES (#{user_id},#{org_id},#{type},#{weight},getDate(),0)
    </insert>
    
    <update id="update" parameterType="Auth">
        update trust set
        trustDate = getDate(),
        status = #{status},
        weight = #{weight}
        where id = #{id}
    </update>

    <select id="getAuth" resultType="Auth">
        SELECT top 1 * from trust where
        user_id = #{user_id}
        and org_id = #{org_id}
        and type = #{type}
    </select>

</mapper>